import React, { useState, useMemo } from 'react';

/**
 * ë¦¼ë²„ìŠ¤ ì»´í¼ë‹ˆ ê±°ìš¸ ë˜ì „ íš¨ìœ¨ ê³„ì‚°ê¸° (UI ìµœì í™” ë²„ì „)
 * - í•˜ë“œ ëª¨ë“œ UI ëŠ˜ì–´ì§ ë°©ì§€ ë° ë ˆì´ì•„ì›ƒ ì•ˆì •í™”
 * - ë³µì¡í•œ ìˆ˜ì‹ ì œê±° ë° ì§ê´€ì ì¸ ê°€ë™ ë¦¬í¬íŠ¸
 * - ì‚¬ìš©ì ì˜¤í•´ ë°©ì§€ë¥¼ ìœ„í•œ í•˜ë“œ ëª¨ë“œ ì¹´ìš´íŠ¸ ì•ˆë‚´ ì¶”ê°€
 */

const App = () => {
  const [dailyRuns, setDailyRuns] = useState(3);
  const [maxEnkephalin, setMaxEnkephalin] = useState(120);
  const [isHardMode, setIsHardMode] = useState(false);
  const [hardStyle, setHardStyle] = useState('bulk'); 

  // --- ì‹œìŠ¤í…œ ìƒìˆ˜ ---
  const BOXES_PER_LEVEL = 3;
  const SHARDS_PER_BOX_EXPECTATION = 2;
  const SHARDS_FOR_IDENTITY = 400;
  
  const DAILY_QUEST_LEVEL = 1; 
  const WEEKLY_QUEST_LEVEL = 2; 
  const MD_NORMAL_LEVEL = 3; 

  const MODULES_PER_RUN = 5;
  const ENKEPHALIN_PER_MODULE = 20;

  const calculations = useMemo(() => {
    const weeklyRuns = dailyRuns * 7;
    const questLevels = (DAILY_QUEST_LEVEL * 7) + WEEKLY_QUEST_LEVEL; 
    
    let mdBonusLevels = 0;
    let bonusRunsCount = 0;

    if (isHardMode) {
      if (hardStyle === 'bulk') {
        mdBonusLevels = 22.5; // í•˜ë“œ 1íŒìœ¼ë¡œ 3íšŒë¶„ ì¼ê´„ ìˆ˜ë ¹
        bonusRunsCount = 1;
      } else {
        mdBonusLevels = 25;   // í•˜ë“œ 3íŒ ê°ê° í´ë¦¬ì–´
        bonusRunsCount = 3;
      }
    } else {
      bonusRunsCount = Math.min(weeklyRuns, 3);
      mdBonusLevels = bonusRunsCount * 4.5;
    }

    const remainingRuns = Math.max(0, weeklyRuns - bonusRunsCount);
    const mdLevels = mdBonusLevels + (remainingRuns * MD_NORMAL_LEVEL);

    const totalWeeklyLevels = questLevels + mdLevels;
    const flooredLevels = Math.floor(totalWeeklyLevels);
    const weeklyBoxes = flooredLevels * BOXES_PER_LEVEL;
    const weeklyShards = weeklyBoxes * SHARDS_PER_BOX_EXPECTATION;
    const identitiesPerWeek = (weeklyShards / SHARDS_FOR_IDENTITY).toFixed(2);
    const weeksForOneIdentity = (SHARDS_FOR_IDENTITY / weeklyShards).toFixed(1);

    // ìì› ê´€ë¦¬ (ê³µê¸‰: ìì—°íšŒë³µ 240 + 2ì¶©)
    const dailyNaturalEnkephalin = 240; 
    const dailyRefillEnkephalin = maxEnkephalin * 2;
    const totalDailyEnkephalin = dailyNaturalEnkephalin + dailyRefillEnkephalin;
    const totalDailyAvailableModules = Math.floor(totalDailyEnkephalin / ENKEPHALIN_PER_MODULE);

    const dailyMDModules = dailyRuns * MODULES_PER_RUN;
    const remainingModules = totalDailyAvailableModules - dailyMDModules;

    const isCritical = remainingModules < 0;
    const isTight = !isCritical && remainingModules < 10;

    return {
      weeklyRuns,
      totalWeeklyLevels,
      flooredLevels,
      weeklyBoxes,
      weeklyShards,
      identitiesPerWeek,
      weeksForOneIdentity,
      dailyMDModules,
      dailyMDEnkephalin: dailyMDModules * ENKEPHALIN_PER_MODULE,
      totalDailyAvailableModules,
      remainingModules,
      isCritical,
      isTight,
      bonusRunsCount,
      remainingRuns,
      mdBonusLevels
    };
  }, [dailyRuns, maxEnkephalin, isHardMode, hardStyle]);

  return (
    <div className="min-h-screen bg-black text-neutral-200 p-4 font-sans flex flex-col items-center selection:bg-red-900">
      <div className="w-full max-w-xl">
        
        {/* Header */}
        <header className="flex flex-col py-6 border-b border-red-900 mb-6">
          <div className="flex items-center gap-3 mb-4">
            <div className="text-red-700">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="16" height="20" x="4" y="2" rx="2"/><line x1="8" x2="16" y1="6" y2="6"/><line x1="16" x2="16" y1="14" y2="18"/><path d="M16 10h.01"/><path d="M12 10h.01"/><path d="M8 10h.01"/><path d="M12 14h.01"/><path d="M8 14h.01"/><path d="M12 18h.01"/><path d="M8 18h.01"/></svg>
            </div>
            <h1 className="text-xl font-black italic uppercase tracking-tighter leading-none text-white">LCB: ê±°ë˜ íš¨ìœ¨ ê³„ì‚°ê¸°</h1>
          </div>
          
          <div className="bg-red-950/20 border border-red-900/40 p-3 rounded flex items-start gap-2">
            <div className="text-red-500 mt-0.5">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>
            </div>
            <p className="text-[11px] text-neutral-400 leading-snug">
              ë³¸ ê³„ì‚°ê¸°ëŠ” <span className="text-white font-bold underline">íŒ¨ìŠ¤ ì¼ì¼/ì£¼ê°„ í€˜ìŠ¤íŠ¸, ì£¼ê°„ ì¶”ê°€ ë³´ìƒ, ì¼ì¼ 2íšŒ ì¶©ì „</span>ì„ 
              ìˆ˜í–‰í•¨ì„ ì „ì œë¡œ ì‚°ì¶œë˜ì—ˆìŠµë‹ˆë‹¤.
            </p>
          </div>
        </header>

        <main className="space-y-6">
          {/* ê°€ë™ ì„¤ì • ì„¹ì…˜ */}
          <div className="bg-neutral-900 border border-neutral-800 rounded-lg p-6 shadow-2xl relative overflow-hidden">
            <div className="absolute top-0 left-0 w-1.5 h-full bg-red-700"></div>
            
            {/* ê²½ê³ /ê¶Œê³  ë©”ì‹œì§€ ì˜ì—­ (ê³µê°„ ê³ ì •) */}
            <div className="min-h-[80px] flex flex-col justify-center mb-6">
              {calculations.isCritical && (
                <div className="bg-red-950/40 border border-red-600 p-3 rounded flex items-center gap-3 animate-pulse">
                  <div className="text-red-500">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><path d="M12 9v4"/><path d="M12 17h.01"/></svg>
                  </div>
                  <div className="text-[11px] text-red-100 font-bold leading-tight">
                    [ê³µê¸‰ í•œê³„ ë„ë‹¬] í•„ìš” ëª¨ë“ˆëŸ‰ì´ ì¼ì¼ ì´ ìˆ˜ê¸‰ëŸ‰({calculations.totalDailyAvailableModules}ê°œ)ì„ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤.<br/>
                    í˜„ì¬ì˜ ì—ë„ˆì§€ ì¶©ì „ ê³„íšìœ¼ë¡œëŠ” í•´ë‹¹ ë¹ˆë„ì˜ ê°€ë™ì„ ê°ë‹¹í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
                  </div>
                </div>
              )}
              {calculations.isTight && (
                <div className="bg-orange-950/20 border border-orange-700/40 p-3 rounded flex items-center gap-3">
                  <div className="text-orange-500">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><path d="M12 9v4"/><path d="M12 17h.01"/></svg>
                  </div>
                  <div className="text-[11px] text-orange-200 font-bold leading-tight">
                    [ìš´ìš© ê¶Œê³ ] ê±°ë˜ í›„ ì”ì—¬ ëª¨ë“ˆì´ <span className="text-white underline">{calculations.remainingModules}ê°œ</span>ì…ë‹ˆë‹¤.<br/>
                    ê²½ë˜ ë° ëˆë˜ ê°€ë™ ê³„íšì— ì°¨ì§ˆì´ ì—†ë‚˜ í™•ì¸í•˜ì„¸ìš”.
                  </div>
                </div>
              )}
            </div>

            <div className="flex gap-8 items-stretch">
              {/* ì™¼ìª½: ì—”ì¼€íŒ”ë¦° ìµœëŒ€ì¹˜ (ìˆ˜ì§ ìŠ¬ë¼ì´ë”) */}
              <div className="flex flex-col items-center gap-3 py-2">
                <div className="flex flex-col items-center">
                   <span className="text-[9px] font-black text-neutral-500 uppercase tracking-widest mb-1 leading-none">Max ENK</span>
                   <span className="text-xl font-black text-white leading-none">{maxEnkephalin}</span>
                </div>
                <div className="relative flex-1 py-2 flex items-center justify-center min-w-[30px]">
                  <input
                    type="range"
                    min="60"
                    max="200"
                    step="1"
                    value={maxEnkephalin}
                    onChange={(e) => setMaxEnkephalin(parseInt(e.target.value))}
                    className="h-[150px] accent-neutral-500 cursor-pointer"
                    style={{ WebkitAppearance: 'slider-vertical', appearance: 'slider-vertical' }}
                  />
                </div>
                <span className="text-[8px] text-neutral-600 font-bold uppercase tracking-widest leading-none">Min 60</span>
              </div>

              {/* ì˜¤ë¥¸ìª½: ê±°ë˜ ê°€ë™ íšŸìˆ˜ ë° ëª¨ë“œ ì„¤ì • */}
              <div className="flex-1 flex flex-col justify-between py-2">
                <div className="flex justify-between items-start">
                  <div>
                    <h2 className="text-xs font-bold text-neutral-400 uppercase tracking-widest leading-none">ì¼ì¼ ê±°ë˜ ë¹ˆë„</h2>
                    <p className="text-[10px] text-neutral-500 italic mt-1 leading-none font-sans">Daily Operation Rate</p>
                  </div>
                  <div className="text-right flex flex-col items-end">
                    <div className="flex items-baseline leading-none">
                      <span className={`text-5xl font-black leading-none tracking-tighter ${calculations.isCritical ? 'text-red-500' : 'text-white'}`}>
                        {dailyRuns}
                      </span>
                      <span className="text-red-700 font-bold ml-1 text-xl italic font-serif leading-none">íšŒ</span>
                    </div>
                    <div className="mt-2 text-neutral-400 font-bold text-[11px] leading-none">
                      ì†Œëª¨: {calculations.dailyMDModules}ëª¨ë“ˆ 
                      <span className="text-[9px] ml-1 font-normal text-neutral-600 font-sans">
                        ({calculations.dailyMDEnkephalin} ENK)
                      </span>
                    </div>
                  </div>
                </div>

                <div className="mt-6">
                  <input
                    type="range"
                    min="1"
                    max="15"
                    step="1"
                    value={dailyRuns}
                    onChange={(e) => setDailyRuns(parseInt(e.target.value))}
                    className={`w-full h-2 rounded-lg appearance-none cursor-pointer ${calculations.isCritical ? 'accent-red-500 bg-red-900/20' : 'accent-red-700 bg-neutral-800'}`}
                  />
                  <div className="flex justify-between text-[9px] text-neutral-600 mt-4 font-mono font-bold uppercase tracking-tighter leading-none">
                    <span>ìµœì†Œ ê°€ë™</span>
                    <span className="text-neutral-500 font-normal">ìˆ˜ê¸‰ ê°€ëŠ¥ ëª¨ë“ˆ: {calculations.totalDailyAvailableModules}ê°œ</span>
                    <span>ìµœëŒ€ ê°€ë™</span>
                  </div>
                </div>

                {/* í•˜ë“œ ëª¨ë“œ ì„¤ì • ì„¹ì…˜ (ê³ ì •ëœ ë†’ì´ë¡œ ëŠ˜ì–´ì§ ë°©ì§€) */}
                <div className="mt-6 pt-4 border-t border-neutral-800 min-h-[110px]">
                  <div className="flex justify-between items-center mb-4">
                    <label className="flex items-center gap-2 cursor-pointer group">
                      <input 
                        type="checkbox" 
                        checked={isHardMode}
                        onChange={(e) => setIsHardMode(e.target.checked)}
                        className="w-4 h-4 accent-red-600 bg-neutral-800 border-zinc-700 rounded cursor-pointer"
                      />
                      <span className={`text-xs font-bold transition-colors ${isHardMode ? 'text-red-500' : 'text-neutral-500 group-hover:text-neutral-300'}`}>
                        ë³´ë„ˆìŠ¤ í•˜ë“œ ëª¨ë“œ ì ìš©
                      </span>
                    </label>
                  </div>

                  {isHardMode ? (
                    <div className="flex gap-2 animate-in fade-in slide-in-from-left-2">
                      <button
                        onClick={() => setHardStyle('bulk')}
                        className={`flex-1 flex flex-col items-center p-3 rounded border transition-all ${
                          hardStyle === 'bulk' 
                            ? 'bg-red-950/30 border-red-800 shadow-[inset_0_0_10px_rgba(153,27,27,0.2)]' 
                            : 'bg-neutral-950 border-neutral-800 hover:border-neutral-700'
                        }`}
                      >
                        <span className={`text-xs font-black ${hardStyle === 'bulk' ? 'text-red-500' : 'text-neutral-500'}`}>3íšŒë¶„ ì¼ê´„ ìˆ˜ë ¹</span>
                        <span className="text-[9px] text-zinc-600 font-bold mt-1 leading-none uppercase italic">í•˜ë“œ 1íŒ ì†Œëª¨</span>
                      </button>
                      <button
                        onClick={() => setHardStyle('each')}
                        className={`flex-1 flex flex-col items-center p-3 rounded border transition-all ${
                          hardStyle === 'each' 
                            ? 'bg-red-950/30 border-red-800 shadow-[inset_0_0_10px_rgba(153,27,27,0.2)]' 
                            : 'bg-neutral-950 border-neutral-800 hover:border-zinc-700'
                        }`}
                      >
                        <span className={`text-xs font-black ${hardStyle === 'each' ? 'text-red-500' : 'text-neutral-500'}`}>3íšŒ ê°ê° í´ë¦¬ì–´</span>
                        <span className="text-[9px] text-zinc-600 font-bold mt-1 leading-none uppercase italic">í•˜ë“œ 3íŒ ì†Œëª¨</span>
                      </button>
                    </div>
                  ) : (
                    <div className="flex items-center justify-center h-[58px] border border-dashed border-neutral-800 rounded opacity-20">
                        <span className="text-[10px] uppercase font-bold tracking-widest">Normal MD Bonus Only</span>
                    </div>
                  )}
                  
                  {isHardMode && (
                    <p className="mt-3 text-[9px] text-neutral-600 italic leading-none">
                      â€» í•˜ë“œ ëª¨ë“œ í´ë¦¬ì–´ íšŸìˆ˜ëŠ” ì£¼ê°„ ê°€ë™ ì´í•©ì— í¬í•¨ë©ë‹ˆë‹¤.
                    </p>
                  )}
                </div>
              </div>
            </div>
          </div>

          {/* ë¦¬í¬íŠ¸ ê·¸ë¦¬ë“œ */}
          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
            <article className="bg-neutral-900 border border-neutral-800 p-5 flex flex-col rounded-md shadow-lg">
              <div className="flex items-center gap-2 mb-4 leading-none font-black text-neutral-500 text-[10px] uppercase tracking-widest">
                <div className="w-1 h-3 bg-red-700"></div>
                ì£¼ê°„ ê°€ë™ ë¶„ì„ ë¦¬í¬íŠ¸
              </div>
              
              <div className="mb-4 p-3 bg-black/50 rounded border border-neutral-800 text-[10px] space-y-3 font-mono">
                <div className="flex justify-between items-center leading-none">
                  <span className="text-red-500 font-bold">ë³´ë„ˆìŠ¤ ê°€ë™ íšŸìˆ˜</span>
                  <span className="text-neutral-300 font-bold">{calculations.bonusRunsCount}íšŒ</span>
                </div>
                <div className="flex justify-between items-center leading-none">
                  <span className="text-neutral-400 font-bold">ì¼ë°˜ ê°€ë™ íšŸìˆ˜</span>
                  <span className="text-neutral-300 font-bold">{calculations.remainingRuns}íšŒ</span>
                </div>
                <div className="pt-2 mt-1 border-t border-neutral-800 flex justify-between text-neutral-300 font-black leading-none">
                  <span className="uppercase tracking-tighter text-neutral-500">ì£¼ê°„ ê°€ë™ ì´í•©</span>
                  <span className="text-white underline underline-offset-4">{calculations.weeklyRuns}íšŒ</span>
                </div>
              </div>

              <div className="space-y-4 flex-1">
                <div className="flex justify-between items-end leading-none">
                  <div className="flex flex-col leading-none">
                    <span className="text-xs text-neutral-400 leading-none">ì£¼ê°„ í•©ì‚° ë ˆë²¨</span>
                    <span className="text-[9px] text-neutral-500 leading-none tracking-tight">ìµœì¢… {calculations.totalWeeklyLevels.toFixed(1)} Lv</span>
                  </div>
                  <span className="text-lg font-bold text-white leading-none">{calculations.flooredLevels} <small className="text-[10px] text-neutral-600 font-normal underline uppercase leading-none">Lv</small></span>
                </div>
                <div className="flex justify-between items-end leading-none">
                  <span className="text-xs text-neutral-400 leading-none font-sans">íŒŒí¸ ìƒì íšë“</span>
                  <span className="text-lg font-bold text-red-600 leading-none">{calculations.weeklyBoxes} <small className="text-[10px] text-neutral-600 font-normal uppercase font-serif leading-none">ea</small></span>
                </div>
                <div className="flex justify-between items-end pt-2 border-t border-neutral-800 leading-none font-sans">
                  <span className="text-xs font-bold text-neutral-300 italic tracking-tighter leading-none">íŒŒí¸ ê¸°ëŒ€ê°’</span>
                  <span className="text-2xl font-black text-yellow-500 font-serif leading-none tracking-tighter">{calculations.weeklyShards}</span>
                </div>
              </div>
            </article>

            <article className="bg-neutral-900 border border-neutral-800 p-5 flex flex-col justify-center rounded-md shadow-lg border-t-2 border-t-yellow-600 relative overflow-hidden font-sans">
              <div className="flex items-center gap-2 mb-4 leading-none tracking-widest font-black uppercase text-neutral-500 text-[10px]">
                <div className="w-1 h-3 bg-yellow-600 font-bold leading-none"></div>
                ì£¼ê°„ ì •ê°€ íš¨ìœ¨ ë¶„ì„
              </div>
              <div className="flex flex-col items-center py-2 leading-none">
                <p className="text-[10px] text-neutral-500 uppercase mb-2 font-bold tracking-tighter leading-none font-sans">Identities Per Week</p>
                <div className="text-5xl font-black text-white tracking-tighter mb-4 leading-none font-sans">
                  {calculations.identitiesPerWeek} <span className="text-lg font-normal text-neutral-500 italic uppercase">ID</span>
                </div>
              </div>
              <div className="bg-red-950/20 border border-red-900/30 p-2 text-center rounded-sm leading-none z-10 font-sans">
                <p className="text-[11px] text-neutral-300 leading-none font-sans">
                  ì¸ê²© 1ê°œ ì •ê°€ê¹Œì§€ ì•½ <span className="text-red-500 font-black leading-none font-sans">{calculations.weeksForOneIdentity}</span>ì£¼ ì†Œìš”
                </p>
              </div>
              
              <div className="mt-4 p-2 bg-black/30 rounded border border-neutral-800 leading-none">
                <p className="text-[9px] text-neutral-500 leading-normal italic font-sans">
                  ğŸ’¡ <span className="text-neutral-400 font-bold">TIP:</span> 'ì¼ê´„ ìˆ˜ë ¹'ì€ í•˜ë“œ 1íŒìœ¼ë¡œ ë³´ë„ˆìŠ¤ ìŠ¬ë¡¯ 3ê°œë¥¼ ëª¨ë‘ ì‚¬ìš©í•˜ë¯€ë¡œ, ë‚¨ì€ íŒìˆ˜ê°€ ì¼ë°˜ ê±°ë˜ìœ¼ë¡œ ì „í™˜ë˜ì–´ ì´ ì ìˆ˜ê°€ ë” ë†’ê²Œ ì‚°ì¶œë©ë‹ˆë‹¤.
                </p>
              </div>
            </article>
          </div>
        </main>

        <footer className="mt-12 text-center border-t border-neutral-900 pt-4 leading-none">
          <p className="text-[9px] text-neutral-800 uppercase tracking-[0.4em] font-bold italic leading-none opacity-50">Authorized Intelligence Unit</p>
        </footer>
      </div>
    </div>
  );
};

export default App;